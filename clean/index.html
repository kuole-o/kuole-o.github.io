<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta name="referrer" content="origin-when-cross-origin"><meta name="color-scheme" content="light dark"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>清理缓存 | Guo Le's Blog</title><meta name="keywords" content="郭乐,Guo Le"><meta name="author" content="夜的第八章"><meta name="copyright" content="夜的第八章"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="description" content="折腾，发呆，躺平，无缝切换的 95 后青年。"><link rel="shortcut icon" href="/favicon.ico"><style>.main{display:inline-block;height:100%;width:100%}@media screen and (min-width:768px){body{width:max-content;margin:5rem}}#button_all{margin:2rem 1rem 1rem 1rem;text-align:center}#output{margin-left:5px}#swCache{margin-top:2rem}#localCache{margin:2rem 0 3rem 0}a.button{color:#256fff;cursor:pointer;margin-right:16px;text-decoration:unset;transition:.3s}a.button:hover{font-weight:600;transition:.3s;text-decoration:underline}li{font-weight:700}li::marker{font-size:12px}p#tip{color:#fff;background:linear-gradient(90deg,#f55555,#fccd31 85%,#f55555);background-size:200% 200%;animation:flow 10s linear infinite;padding:4px 8px;border-radius:4px;text-align:center;margin:0 1rem}@keyframes flow{0%{background-position:100% 30%}100%{background-position:-100% -30%}}p#info{color:#707070;margin:12px 0}h1#title{margin-top:3rem;margin-bottom:1rem}</style></head><body><h1 id="title">缓存自助清理</h1><p id="info">在浏览本站发生异常时，可通过下方按钮清空缓存解决。大多数时候，仅需点击“常规清理”。</p><div class="main"><div id="output"><div id="time"></div><div id="swCache"></div><div id="localCache"></div><p id="tip">等待指令…</p></div><div id="button_all"><a class="button" onclick='refreshCache(1,"主动点击按钮（常规清理）：")'>常规清理</a> <a class="button" onclick='refreshCache(0,"主动点击按钮（全部清理）：")'>全部清理</a> <a class="button" href="/">回到首页</a></div></div><script defer>function time(){return(new Date).toLocaleString().split("/").join("-")}function outputMessage(e,t){const o=document.createElement("p");o.innerHTML=time()+" "+e+t,document.getElementById("tip").style.display="none",document.getElementById("output").appendChild(o)}async function getCacheNames(){return await caches.keys()}async function getData(){const e=document.getElementById("swCache"),t=document.getElementById("localCache");try{const t=await getCacheNames();e.innerHTML+=`<p>本地存在的 Service Worker 缓存为：${t.length} 条</p>`,t.forEach((t=>{e.innerHTML+=`<li>${t}</li>`}))}catch(t){console.error("获取缓存名称时出错：",t),e.innerHTML+="<p>获取缓存名称时出错。</p>"}t.innerHTML+=`<p>本地存在的 localStorage 缓存为：${localStorage.length} 条</p>`;for(let e=0;e<localStorage.length;e++){const o=localStorage.key(e);t.innerHTML+=`<li>${o}</li>`}}async function refreshCache(e,t){let o,n=[];const a=async e=>{try{await caches.delete(e),n.push(e),o=`已清理缓存：${e}`,console.log(o),outputMessage(t,o)}catch(t){console.error(`清理缓存 ${e} 时出错：`,t)}};try{const c=(await getCacheNames()).map((t=>1===e&&"Blog"===t||0===e?a(t):void 0)).filter(Boolean);await Promise.all(c),localStorage.length>0&&(Object.keys(localStorage).forEach((e=>{localStorage.removeItem(e)})),0==localStorage.length&&(o="localStorage 已全部清除。",console.log(o),outputMessage(t,o))),n.length>0?(o=`本地 Service Worker 缓存已全部清除：${n.join(", ")}`,console.log(o),outputMessage(t,o)):(console.log("没有发现可清理的缓存。"),outputMessage(t,"没有发现可清理的缓存。"))}catch(e){console.error("清理缓存时出错：",e)}}getData(),window.location.search.length>0&&window.location.search.includes("type=1")&&refreshCache(1,"参数调用（常规清理）："),window.location.search.length>0&&window.location.search.includes("type=0")&&refreshCache(0,"参数调用（常规清理）："),document.addEventListener("pjax:complete",(()=>{getData(),window.location.search.length>0&&window.location.search.includes("type=1")&&refreshCache(1,"参数调用（常规清理）："),window.location.search.length>0&&window.location.search.includes("type=0")&&refreshCache(0,"参数调用（常规清理）："),console.log("触发 pjax:complete 事件。")}))</script></body></html>